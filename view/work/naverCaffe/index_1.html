<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>jquery.wonchu</title>
<link href='/css/base.css' rel='stylesheet' type='text/css' />
<style type='text/css'>
	.input{border:none;width:100%;height:25px;}
	.line{padding:5px 10px;border-top:1px solid #dddddd;width:100%;min-height:30px}
	.none{display:none;}
</style>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script src="/js/jquery.tmpl.js" type="text/javascript"></script>
<script type="text/javascript">


var dynaWrite = new(function() {
	var index = 0;
	var currentIndex = 0;
	var constant = {
		textarea : "#writeTextarea",
		view	 : "#viewDiv",
		write	 : "#writeDiv"
	};
	
	var tmpl = {	
		div 	 :	"<div class=\"line div\" style=\"display:none;\" onclick=\"showWrite(this)\">" +
					"	<div id=\"div${id}\"></textarea>" +
					"</div>",
		image 	 :	"<div class=\"line image\">" +
					"	<img id=\"img${id}\" src=\"${src}\" />" +
					"</div>"
	};
	
	function init(){
		var $t = $(constant.textarea);
   		var $m = $("<div class=\"autogrow-textarea-mirror\"></div>");
   		
		$m.css({
			"display":"none",
			"word-wrap":"break-word",
			"white-space":"normal",
			"padding":$t.css('padding'),
			"width":$t.css('width'),
			"line-height":$t.css('line-height')
		});
		
   		$t.css({
   			"overflow":"hidden"
   		}).after($m);
   		
   		$t.on("keyup", function(){
   			$m.html(convert($t.val()) + '.<br/>.');
   			if ($t.height() < $m.height()){
   				$t.height($m.height());
   			}
   		});

   		$t.trigger("keyup");
	}
	
	function add(){
		if($(constant.view).find(">div").length==0){
			toogle("write");
		}else if($("#write textarea").length==1){
			
		}
	}
	
	function create(n){
		$("#write").append($.tmpl(tmpl.textarea, {id:n, value:""}));
	    $("#textarea" + n).autoGrow();
	}
	
	function showWrite(t){
		$("#write,#view,#add").toggle();
	}
	
	function setDiv(){
		$("#div" + currentIndex).html(convert($("#textarea" + currentIndex).val())).parent().show();
		$("#write,#view,#add").toggle();
	}
	
	function setImage(){
		toogle(false);
	}
	
	function convert(v){
		return String(v).replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br />');
	}
	
	function toogle(v){
		if(v=="write"){
			$("#write").show();
			$("#view,#add").hide();
		}else{
			$("#write").hide();
			$("#view,#add").show();
		}
	}
	
	return {
   		init : init,
   		add : add
   	};
});


$(function() {
	dynaWrite.init();
});

</script>
</head>
<body>
<div id="baseDiv">
	<div class="line">
		<select id="boardId"><option>게시판 선택</option></select>
	</div>
	<div class="line">
		<input type="text" name="title" class="input" placeholder="제목">
	</div>
</div>
<div id="viewDiv"></div>
<div id="add">
	<div class="line" onclick="dynaWrite.add();">
		<input type="text" class="input" placeholder="내용" readonly="readonly">
	</div>
</div>
<div id="writeDiv" class="none"><textarea id="writeTextarea" style="border:none;height:25px;width:100%"></textarea></div>
<div id="buttonDiv">
	<input type="button" value="이미지" onclick="setImage()" />
	<input type="button" value="완료" onclick="setDiv()" class="none" />
</div>
<div height="300px" designmode="on" contenteditable="true">aaa</div>
</body>
</html>